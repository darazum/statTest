# statTest

Здесь опишу что в обоиме и какие решения были приняты по ходу разработки


1. На приемке трафика nginx
2. За ним 2 инстанса (эмулирую масштабирование докером app1 / app2) с php-swoole
3. Почему выбрал swoole - решил попробовать, говорят это быстрее php-fpm (пожалел)
4. Фреймворк php slim, по минимуму - Di, Ps4-request
5. Хранилище - redis, обычный, с синком с диском

Про редис и хранение данных.
Данные храним в ключиках visit:{country} - готовимся потенциально жить в кластере.
Была у меня развилка - эмулировать редис-кластеро докером 
(думаю я бы умер, как минимум не все php-либы для этого подходят) или сделать "наколеночное" масштабирование
силами php (2 инстанса редиса, ручками в коде выбираем по crc32 от кода страны).
Первое решение убийсвтенно по времени для теста, второе - плохо в проде в плане масштабирования 
(придется прееносить ключи руками).

В общем решил что я об этом поговорю, мол в проде будет кластер и этого достаточно.

Также упростил себе задачу, считая что список всех кантри-кодов известен (захардкодил в CountryListService)

Если все же захочется собирать его на лету - сделал бы через очередь, которая агрегирует кучу событий,
в памяти выбирает новые поступившие кантри коды и одним запросом обновляет хэш-мапу в редисе.